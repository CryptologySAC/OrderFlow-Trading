<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>DeltaCVD A/B Testing Dashboard</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    sans-serif;
                background-color: #0a0a0a;
                color: #e0e0e0;
                padding: 20px;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
            }

            h1 {
                font-size: 2.5rem;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

            .subtitle {
                color: #888;
                margin-bottom: 30px;
                font-size: 1.1rem;
            }

            .metrics-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .metric-card {
                background: #1a1a1a;
                border-radius: 12px;
                padding: 24px;
                border: 1px solid #2a2a2a;
                position: relative;
                overflow: hidden;
            }

            .metric-card::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(90deg, #667eea, #764ba2);
            }

            .metric-card.winner::before {
                background: linear-gradient(90deg, #10b981, #059669);
            }

            .metric-label {
                font-size: 0.875rem;
                color: #888;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 8px;
            }

            .metric-value {
                font-size: 2rem;
                font-weight: 600;
                margin-bottom: 8px;
            }

            .metric-change {
                font-size: 0.875rem;
                display: flex;
                align-items: center;
                gap: 4px;
            }

            .positive {
                color: #10b981;
            }

            .negative {
                color: #ef4444;
            }

            .chart-container {
                background: #1a1a1a;
                border-radius: 12px;
                padding: 24px;
                border: 1px solid #2a2a2a;
                margin-bottom: 20px;
                height: 400px;
                position: relative;
            }

            .profile-comparison {
                background: #1a1a1a;
                border-radius: 12px;
                padding: 24px;
                border: 1px solid #2a2a2a;
                margin-bottom: 20px;
            }

            .comparison-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 16px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #2a2a2a;
            }

            .comparison-table th {
                font-weight: 600;
                color: #888;
                text-transform: uppercase;
                font-size: 0.875rem;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: #2a2a2a;
                border-radius: 4px;
                overflow: hidden;
                margin-top: 8px;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #667eea, #764ba2);
                transition: width 0.3s ease;
            }

            .insights-section {
                background: #1a1a1a;
                border-radius: 12px;
                padding: 24px;
                border: 1px solid #2a2a2a;
            }

            .insight-item {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px 0;
                border-bottom: 1px solid #2a2a2a;
            }

            .insight-item:last-child {
                border-bottom: none;
            }

            .insight-icon {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
            }

            .insight-icon.performance {
                background: rgba(16, 185, 129, 0.1);
                color: #10b981;
            }

            .insight-icon.memory {
                background: rgba(59, 130, 246, 0.1);
                color: #3b82f6;
            }

            .insight-icon.quality {
                background: rgba(139, 92, 246, 0.1);
                color: #8b5cf6;
            }

            .status-indicator {
                display: inline-block;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                margin-right: 8px;
                animation: pulse 2s infinite;
            }

            .status-indicator.active {
                background: #10b981;
            }

            @keyframes pulse {
                0% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.5;
                }
                100% {
                    opacity: 1;
                }
            }

            .controls {
                display: flex;
                gap: 12px;
                margin-bottom: 20px;
            }

            .btn {
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                background: #2a2a2a;
                color: #e0e0e0;
                cursor: pointer;
                transition: all 0.2s;
            }

            .btn:hover {
                background: #3a3a3a;
            }

            .btn.primary {
                background: linear-gradient(135deg, #667eea, #764ba2);
            }

            .btn.primary:hover {
                opacity: 0.9;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>DeltaCVD A/B Testing Dashboard</h1>
            <p class="subtitle">
                Real-time performance comparison of passive volume
                configurations
            </p>

            <div class="controls">
                <button class="btn primary" onclick="startMonitoring()">
                    <span class="status-indicator active"></span>
                    Start Monitoring
                </button>
                <button class="btn" onclick="exportResults()">
                    Export Results
                </button>
                <button class="btn" onclick="resetData()">Reset Data</button>
            </div>

            <div class="metrics-grid">
                <div class="metric-card" id="simplified-no-passive-card">
                    <div class="metric-label">Simplified (No Passive)</div>
                    <div class="metric-value" id="simplified-no-passive-score">
                        0.00
                    </div>
                    <div class="metric-change positive">
                        <span>↑</span>
                        <span id="simplified-no-passive-change">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            id="simplified-no-passive-progress"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="metric-card" id="simplified-with-passive-card">
                    <div class="metric-label">Simplified (With Passive)</div>
                    <div
                        class="metric-value"
                        id="simplified-with-passive-score"
                    >
                        0.00
                    </div>
                    <div class="metric-change positive">
                        <span>↑</span>
                        <span id="simplified-with-passive-change">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            id="simplified-with-passive-progress"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>

                <div class="metric-card" id="current-complex-card">
                    <div class="metric-label">Current Complex</div>
                    <div class="metric-value" id="current-complex-score">
                        0.00
                    </div>
                    <div class="metric-change">
                        <span>→</span>
                        <span id="current-complex-change">0.0%</span>
                    </div>
                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            id="current-complex-progress"
                            style="width: 0%"
                        ></div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="performanceChart"></canvas>
            </div>

            <div class="profile-comparison">
                <h2>Profile Comparison</h2>
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Simplified (No Passive)</th>
                            <th>Simplified (With Passive)</th>
                            <th>Current Complex</th>
                        </tr>
                    </thead>
                    <tbody id="comparisonTableBody">
                        <tr>
                            <td>Processing Time (ms)</td>
                            <td id="proc-time-no-passive">-</td>
                            <td id="proc-time-with-passive">-</td>
                            <td id="proc-time-complex">-</td>
                        </tr>
                        <tr>
                            <td>Memory Usage (MB)</td>
                            <td id="memory-no-passive">-</td>
                            <td id="memory-with-passive">-</td>
                            <td id="memory-complex">-</td>
                        </tr>
                        <tr>
                            <td>Signal Quality</td>
                            <td id="quality-no-passive">-</td>
                            <td id="quality-with-passive">-</td>
                            <td id="quality-complex">-</td>
                        </tr>
                        <tr>
                            <td>Error Rate</td>
                            <td id="error-no-passive">-</td>
                            <td id="error-with-passive">-</td>
                            <td id="error-complex">-</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="insights-section">
                <h2>Insights & Recommendations</h2>
                <div id="insightsList">
                    <div class="insight-item">
                        <div class="insight-icon performance">🚀</div>
                        <div>Waiting for data...</div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let performanceChart;
            let ws;
            let testData = {
                labels: [],
                datasets: [
                    {
                        label: "Simplified (No Passive)",
                        data: [],
                        borderColor: "#667eea",
                        backgroundColor: "rgba(102, 126, 234, 0.1)",
                        tension: 0.4,
                    },
                    {
                        label: "Simplified (With Passive)",
                        data: [],
                        borderColor: "#10b981",
                        backgroundColor: "rgba(16, 185, 129, 0.1)",
                        tension: 0.4,
                    },
                    {
                        label: "Current Complex",
                        data: [],
                        borderColor: "#ef4444",
                        backgroundColor: "rgba(239, 68, 68, 0.1)",
                        tension: 0.4,
                    },
                ],
            };

            function initChart() {
                const ctx = document
                    .getElementById("performanceChart")
                    .getContext("2d");
                performanceChart = new Chart(ctx, {
                    type: "line",
                    data: testData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: "Performance Over Time",
                                color: "#e0e0e0",
                                font: { size: 16 },
                            },
                            legend: {
                                labels: { color: "#e0e0e0" },
                            },
                        },
                        scales: {
                            x: {
                                grid: { color: "#2a2a2a" },
                                ticks: { color: "#888" },
                            },
                            y: {
                                grid: { color: "#2a2a2a" },
                                ticks: { color: "#888" },
                                title: {
                                    display: true,
                                    text: "Overall Score",
                                    color: "#888",
                                },
                            },
                        },
                    },
                });
            }

            function startMonitoring() {
                if (ws && ws.readyState === WebSocket.OPEN) return;

                ws = new WebSocket("ws://localhost:3000/deltacvd-ab");

                ws.onopen = () => {
                    console.log("Connected to A/B test monitor");
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    updateDashboard(data);
                };

                ws.onerror = (error) => {
                    console.error("WebSocket error:", error);
                };
            }

            function updateDashboard(data) {
                if (data.type === "comparison") {
                    updateMetrics(data.comparison);
                    updateChart(data.comparison);
                    updateInsights(data.comparison.insights);
                } else if (data.type === "status") {
                    updateStatus(data.status);
                }
            }

            function updateMetrics(comparison) {
                const profiles = [
                    "simplified_no_passive",
                    "simplified_with_passive",
                    "current_complex",
                ];
                const leader = comparison.leader;

                profiles.forEach((profile) => {
                    const score =
                        comparison.metrics.overallScore.get(profile) || 0;
                    const scoreElement = document.getElementById(
                        `${profile.replace(/_/g, "-")}-score`
                    );
                    const progressElement = document.getElementById(
                        `${profile.replace(/_/g, "-")}-progress`
                    );
                    const cardElement = document.getElementById(
                        `${profile.replace(/_/g, "-")}-card`
                    );

                    scoreElement.textContent = score.toFixed(2);
                    progressElement.style.width = `${Math.min(100, score * 100)}%`;

                    if (profile === leader) {
                        cardElement.classList.add("winner");
                    } else {
                        cardElement.classList.remove("winner");
                    }
                });
            }

            function updateChart(comparison) {
                const timestamp = new Date().toLocaleTimeString();
                testData.labels.push(timestamp);

                if (testData.labels.length > 20) {
                    testData.labels.shift();
                    testData.datasets.forEach((dataset) =>
                        dataset.data.shift()
                    );
                }

                testData.datasets[0].data.push(
                    comparison.metrics.overallScore.get(
                        "simplified_no_passive"
                    ) || 0
                );
                testData.datasets[1].data.push(
                    comparison.metrics.overallScore.get(
                        "simplified_with_passive"
                    ) || 0
                );
                testData.datasets[2].data.push(
                    comparison.metrics.overallScore.get("current_complex") || 0
                );

                performanceChart.update();
            }

            function updateInsights(insights) {
                const insightsList = document.getElementById("insightsList");
                insightsList.innerHTML = "";

                insights.forEach((insight) => {
                    const item = document.createElement("div");
                    item.className = "insight-item";

                    const icon = document.createElement("div");
                    icon.className = "insight-icon";

                    if (insight.includes("memory")) {
                        icon.className += " memory";
                        icon.textContent = "💾";
                    } else if (
                        insight.includes("speed") ||
                        insight.includes("faster")
                    ) {
                        icon.className += " performance";
                        icon.textContent = "🚀";
                    } else {
                        icon.className += " quality";
                        icon.textContent = "✨";
                    }

                    const text = document.createElement("div");
                    text.textContent = insight;

                    item.appendChild(icon);
                    item.appendChild(text);
                    insightsList.appendChild(item);
                });
            }

            function exportResults() {
                // Implement export functionality
                console.log("Exporting results...");
            }

            function resetData() {
                testData.labels = [];
                testData.datasets.forEach((dataset) => (dataset.data = []));
                performanceChart.update();
            }

            // Initialize on load
            window.onload = () => {
                initChart();
                // Auto-start monitoring in development
                if (window.location.hostname === "localhost") {
                    setTimeout(startMonitoring, 1000);
                }
            };
        </script>
    </body>
</html>
